<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wheel Spinner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
            background-color: #121212;
            color: #ffffff;
        }
        h1 {
            color: #FFD700;
        }
        .wheel-container {
            margin: 20px auto;
            display: inline-block;
            position: relative;
        }
        .wheel {
            width: 200px;
            height: 200px;
            border: 5px solid #FFD700;
            border-radius: 50%;
            position: relative;
            background: radial-gradient(circle, #2E7D32, #1B5E20);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            cursor: grab;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            user-select: none;
        }
        .wheel:active {
            cursor: grabbing;
        }
        .arrow {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 40px solid #FFD700;
        }
        .counter {
            font-size: 28px;
            font-weight: bold;
            color: #FFD700;
        }
    </style>
</head>
<body>
    <h1>Spin the Wheel!</h1>
    <p>Spin to get coins!</p>

    <!-- Wheel container -->
    <div class="wheel-container">
        <div class="arrow"></div>
        <div class="wheel" id="wheel">Spin to get coins!</div>
    </div>

    <!-- Display the counter -->
    <p>Coins: <span class="counter" id="counter">0</span></p>
    <p>Angle: <span class="counter" id="angle">0</span>Â°</p>

    <script>
        let count = localStorage.getItem('coinCount') ? parseInt(localStorage.getItem('coinCount')) : 0; // Load saved coin count from localStorage or start at 0
        let currentAngle = 0; // The current angle of the wheel
        let lastAngle = 0; // The last recorded angle
        let totalRotation = 0; // Cumulative rotation
        let isDragging = false; // Whether the wheel is being dragged

        const wheel = document.getElementById('wheel');
        const counterDisplay = document.getElementById('counter');
        const angleDisplay = document.getElementById('angle');

        // Function to calculate the angle based on mouse position
        function getAngle(event) {
            const rect = wheel.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            const x = event.clientX - centerX;
            const y = event.clientY - centerY;
            return Math.atan2(y, x) * (180 / Math.PI);
        }

        // Normalize angle to range [0, 360]
        function normalizeAngle(angle) {
            return (angle + 360) % 360;
        }

        // Start dragging
        function startDrag(event) {
            isDragging = true;
            lastAngle = normalizeAngle(getAngle(event)); // Get the initial angle when the drag starts
            totalRotation = 0; // Reset total rotation for a new spin
        }

        // Drag the wheel
        function dragWheel(event) {
            if (!isDragging) return;

            const currentAngleNow = normalizeAngle(getAngle(event));
            const deltaAngle = currentAngleNow - lastAngle;

            // Handle angle wrap-around from 0 to 360
            if (deltaAngle > 180) {
                totalRotation -= 360 - deltaAngle; // Correct for clockwise wrap-around
            } else if (deltaAngle < -180) {
                totalRotation += 360 + deltaAngle; // Correct for counterclockwise wrap-around
            } else {
                totalRotation += deltaAngle; // Normal rotation
            }

            // Check if a full rotation is completed
            if (Math.abs(totalRotation) >= 360) {
                count++;
                totalRotation = 0; // Reset total rotation after counting
                localStorage.setItem('coinCount', count); // Save the updated coin count in localStorage
            }

            // Update the wheel rotation and displays
            currentAngle = (currentAngle + deltaAngle) % 360; // Update the wheel's displayed rotation
            wheel.style.transform = `rotate(${currentAngle}deg)`;
            counterDisplay.innerText = count; // Update the count display
            angleDisplay.innerText = Math.round(currentAngle % 360); // Display the angle

            lastAngle = currentAngleNow; // Update the last recorded angle
        }

        // End dragging
        function endDrag() {
            isDragging = false;
        }

        // Event listeners for mouse
        wheel.addEventListener('mousedown', startDrag);
        window.addEventListener('mousemove', dragWheel);
        window.addEventListener('mouseup', endDrag);

        // Event listeners for touch
        wheel.addEventListener('touchstart', (event) => startDrag(event.touches[0]));
        window.addEventListener('touchmove', (event) => dragWheel(event.touches[0]));
        window.addEventListener('touchend', endDrag);

        // Disable pull-to-refresh on mobile devices
        window.addEventListener('touchmove', (event) => {
            event.preventDefault(); // Prevent the page from refreshing when swiping
        }, { passive: false });

        // Set the initial coin count from localStorage
        counterDisplay.innerText = count;
    </script>
</body>
</html>
